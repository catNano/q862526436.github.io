<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="西决的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="西决的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="西决">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>西决的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">西决的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/31/essay06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/31/essay06/" class="post-title-link" itemprop="url">前端之docker镜像讲解（四）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-31 11:30:06" itemprop="dateCreated datePublished" datetime="2021-01-31T11:30:06+08:00">2021-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 09:31:24" itemprop="dateModified" datetime="2021-02-01T09:31:24+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Docker-镜像讲解"><a href="#Docker-镜像讲解" class="headerlink" title="Docker 镜像讲解"></a>Docker 镜像讲解</h2><h3 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行开发的软件，它包含运行某个软件所需的所有的内容，包含代码、运行时的库、环境变了和配置文件。</p>
<p>所有的应用，直接打包 docker 镜像，就可以直接跑起来！</p>
<p><strong>如何得到镜像：</strong></p>
<ul>
<li>从远端仓库下载</li>
<li>朋友拷贝</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h3 id="Docker-镜像加载原理"><a href="#Docker-镜像加载原理" class="headerlink" title="Docker 镜像加载原理"></a>Docker 镜像加载原理</h3><blockquote>
<p>UninoFS（联合文件系统）</p>
</blockquote>
<p>下载时看到的一层一层就是这个！</p>
<p>UninoFS：是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，UninoFS 文件系统是 docker 镜像的基础，镜像可以通过分层来实现的，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但是从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会保函所有底层的文件和目录。</p>
<blockquote>
<p>Docker 镜像加载原理</p>
</blockquote>
<p>Docker 的镜像实际上由一层一层的文件系统组成，这种层级的文件系统（UinnioFS）</p>
<p>（系统启动需要引导加载）黑屏-开机-显示屏幕 –加载</p>
<p>Bootfs（boot file system）主要包括 bootloader 和 kernel，bootloader 主要时引导加载 kernal，Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层是 bootfs，这一层与我们典型的 Linux 系统时一样的，包含 boot 加载器和内核，当 boot 加载完成之后整个内核都在内存中了，此时内存的使用权已有 bootfs 转交给内核，此时也会卸载 bootfs。</p>
<p>Rootfs（root file system）在 bootfs 之上，包含的就是典型的 linux 系统中的/dev /proc /bin /etc 等标准目录和文件，rootfs 就是各种不同的操作系统发行版，比如 Ubuntu，Centos。</p>
<p>对于一个精简的 OS(内核)，rootfs 可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用 Host（主机的）的 Kernel,自己只需要提供 rootfs 就可以了，由此可见对于不同的 linux 发行版，bootfs 基本时一致的，因此不同的发行版可以公用 bootfs。</p>
<p>虚拟机是分钟级，容器是秒级的！</p>
<h3 id="分层的原理"><a href="#分层的原理" class="headerlink" title="分层的原理"></a>分层的原理</h3><p>所有的 docker 镜像都起始于一个基础镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建新的镜像层，比如：假设基于 Ubuntu Linux 16.04 创建一个新的镜像，这就是新镜像的第一层，如果在该镜像中添加 python 包，就会在基础镜像层之上创建第二个镜像层，如果继续添加一个安全补丁，就会创建第三个镜像层，该镜像当前已经包含 3 个镜像层。</p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要！</p>
<p><strong>注意</strong>：假如在 docker 中又添加了 python 的最新版本，这时，docker 并不会新增加一层，而是用最新版本的 python 替换了原来的旧版本 python！</p>
<p><strong>扩展：</strong><br>Linux 上可用的存储引擎有 AUFS,Overlay2，Device mapper， btrfs，以及 ZFS 顾名思义，每种存储引擎都是基于 Linux 中对应的文件系统或块设备技术，并且每种存储引擎都有其独特的性能特点。</p>
<p>Docker 在 windows 上仅支持 windowsfiler 一种存储引擎，该引擎基于 NTFS 文件系统之上实现了分层和 Cow</p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<p>![image-20210128111514022](/Users/wk/Library/Application Support/typora-user-images/image-20210128111514022.png)</p>
<h3 id="commit-镜像"><a href="#commit-镜像" class="headerlink" title="commit 镜像"></a>commit 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令和git原理类似</span></span><br><span class="line">docker commit -m=“提交的描述信息” -a=“作者” 容器id 目标镜像名：[TAG]</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、启动一个默认的tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、发现这个默认的tomcat是没有webapps的应用，镜像的原因，官方的镜像默认webapps下面是没有文件的！</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、自己拷贝进去基本的文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4、将我们操作过的容器通过commit提交为一个镜像！我们以后就使用我们修改过的镜像即可，这就是我们自己的一个修改的镜像</span></span><br><span class="line">docker commit -a=&quot;wangkai&quot; -m=&quot;add webapps app&quot; 7e119b82cff6 tomcat02:1.0</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/28/essay05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/28/essay05/" class="post-title-link" itemprop="url">前端之docker常用命令（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-28 15:26:52" itemprop="dateCreated datePublished" datetime="2021-01-28T15:26:52+08:00">2021-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 09:29:59" itemprop="dateModified" datetime="2021-02-01T09:29:59+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Docker-的常用命令"><a href="#Docker-的常用命令" class="headerlink" title="Docker 的常用命令"></a>Docker 的常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight shell"><figcaption><span>l</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version			 #显示docker的版本信息</span><br><span class="line">docker info					 #显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 --help	 #帮助命令</span><br></pre></td></tr></table></figure>
<p>帮助文档的地址：</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><p><strong>docker images</strong> 查看本地的主机上的所有镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    bf756fb1ae65   13 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">	解释</span></span><br><span class="line">REPOSITORY	镜像的仓库源</span><br><span class="line">TAG					镜像的标签</span><br><span class="line">IMAGE ID		镜像的id</span><br><span class="line">CREATED			镜像的创建时间</span><br><span class="line">SIZE				镜像的大小</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">	可选项</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             #	列出所有镜像</span><br><span class="line">  -q, --quiet           #	只显示镜像的id</span><br></pre></td></tr></table></figure>
<p><strong>docker search</strong> 镜像搜索</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search mysql</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   10425     [OK]</span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MyS…   3868      [OK]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">	可选项，通过搜藏来过滤</span></span><br><span class="line">Options:</span><br><span class="line">	--filter=STARS=3000	# 搜索STARS大于3000的镜像</span><br></pre></td></tr></table></figure>
<p><strong>docker pull</strong> 下载镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载镜像 docker pull 镜像名[:tag（版本号）]</span></span><br><span class="line">[root@localhost ~]# docker pull mysql</span><br><span class="line">Using default tag: latest	#	如果不写tag，默认就是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete 	#	分层下载，docker image的核心，联合文件系统</span><br><span class="line">f6c208f3f991: Pull complete</span><br><span class="line">88a9455a9165: Pull complete</span><br><span class="line">406c9b8427c6: Pull complete</span><br><span class="line">7c88599c0b25: Pull complete</span><br><span class="line">25b5c6debdaf: Pull complete</span><br><span class="line">43a5816f1617: Pull complete</span><br><span class="line">1a8c919e89bf: Pull complete</span><br><span class="line">9f3cf4bd1a07: Pull complete</span><br><span class="line">80539cea118d: Pull complete</span><br><span class="line">201b3cad54ce: Pull complete</span><br><span class="line">944ba37e1c06: Pull complete</span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c	#签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest	#真实地址</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">	等价</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">	指定版本下载</span></span><br><span class="line">[root@localhost ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists</span><br><span class="line">f6c208f3f991: Already exists</span><br><span class="line">88a9455a9165: Already exists</span><br><span class="line">406c9b8427c6: Already exists</span><br><span class="line">7c88599c0b25: Already exists</span><br><span class="line">25b5c6debdaf: Already exists</span><br><span class="line">43a5816f1617: Already exists</span><br><span class="line">1831ac1245f4: Pull complete</span><br><span class="line">37677b8c1f79: Pull complete</span><br><span class="line">27e4ac3b0f6e: Pull complete</span><br><span class="line">7227baa8c445: Pull complete</span><br><span class="line">Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>
<p><strong>docker rmi</strong> 删除镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker rmi -f 容器id	#删除指定的容器</span><br><span class="line">[root@localhost ~]# docker rmi -f 容器id 容器id 容器id 容器id	#删除多个容器</span><br><span class="line">[root@localhost ~]# docker rmi -f $(docker images -aq)	#删除全部的容器</span><br></pre></td></tr></table></figure>
<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>说明：我们有了镜像才可以创建容器，linux，下载一个 centos 镜像来测试学习</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] images</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name=&quot;Name&quot;			容器名字tomcat01 tomcat02，用来区分容器</span><br><span class="line">-d								后台方式运行</span><br><span class="line">-it								使用交互方式运行，进入容器查看内容</span><br><span class="line">-p								指定容器的端口 -p 8080:8080</span><br><span class="line">    -p ip：主机端口：容器端口</span><br><span class="line">		-p 主机端口：容器端口（常用）</span><br><span class="line">		-p 容器端口</span><br><span class="line">-P								指定随机端口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试，启动并进入容器</span></span><br><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@a832519837dd /]# ls			# 查看容器内的centos，基础版本，很多命令都是不完善的！</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">从容器中退回主机</span></span><br><span class="line">[root@a832519837dd /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
<p><strong>列出所有运行中的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps 命令</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 列出当前正在运行的容器</span></span><br><span class="line">-a			# 列出当前正在运行的容器和历史运行过的容器</span><br><span class="line">-n=？	# 显示最近创建的容器（?表示显示几条）</span><br><span class="line">-q		# 只显示容器的编号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                          PORTS     NAMES</span><br><span class="line">a832519837dd   centos         &quot;/bin/bash&quot;   4 minutes ago   Exited (0) About a minute ago             charming_albattani</span><br><span class="line">9cffc5c689b3   bf756fb1ae65   &quot;/hello&quot;      8 days ago      Exited (0) 8 days ago                     practical_pasteur</span><br></pre></td></tr></table></figure>
<p><strong>退出</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit	# 直接容器停止并退出</span><br><span class="line">Ctrl + P + Q	# 容器不停止退出</span><br></pre></td></tr></table></figure>
<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id								# 删除指定的容器，不能删除正在运行的容器，如果要强制删除 rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)		# 删除全部的容器</span><br><span class="line">docker ps -a -q|xargs docker rm	# 删除所有的容器</span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id			# 启动容器</span><br><span class="line">docker restart 容器id		# 重启容器</span><br><span class="line">docker stop 容器id			# 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id			# 强制停止当前容器</span><br></pre></td></tr></table></figure>
<h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker run -d 镜像名！</span></span><br><span class="line">[root@localhost ~]# docker run -d centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 问题docker ps，发现centos停止了</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常见的坑；docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>
<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf --tail 容器</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自己编写一段shell脚本</span></span><br><span class="line">[root@localhost ~]# docker run -d centos /bin/sh -c &quot;while true;do echo wangkai;sleep 1;done&quot;</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE</span><br><span class="line">56547a01d8ee   centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示日志</span></span><br><span class="line">-tf						# 显示所有日志</span><br><span class="line">--tail number # 要显示的日志条数</span><br><span class="line">[root@localhost ~]# docker logs -tf --tail 10 56547a01d8ee</span><br></pre></td></tr></table></figure>
<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令 docker top 容器id</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker top 56547a01d8ee</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY</span><br><span class="line">root                32408               32388               0                   15:10               ?</span><br><span class="line">root                32473               32408               0                   15:10               ?</span><br></pre></td></tr></table></figure>
<p><strong>查看镜像的元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker inspect 容器id</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost ~]# docker inspect 56547a01d8ee</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-01-27T07:04:50.87392104Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo wangkai;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;exited&quot;,</span><br><span class="line">            &quot;Running&quot;: false,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 0,</span><br><span class="line">            &quot;ExitCode&quot;: 137,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-01-27T07:10:21.973991772Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;2021-01-27T07:13:34.373209298Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928/56547a01d8ee06d3adcf78b1c41d5308c244c70226f0c3640bff927a8e328928-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/frosty_hopper&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/55264444ce1db461f5e5d0db40c0cff86d5a21d3237acf98dc28e24e33b28740-init/diff:/var/lib/docker/overlay2/265e54eb52f11257d1153719d22793e378ea620d845a9a7cb28546c7a6ed4b73/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/55264444ce1db461f5e5d0db40c0cff86d5a21d3237acf98dc28e24e33b28740/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/55264444ce1db461f5e5d0db40c0cff86d5a21d3237acf98dc28e24e33b28740/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/55264444ce1db461f5e5d0db40c0cff86d5a21d3237acf98dc28e24e33b28740/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;56547a01d8ee&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo kuangshen;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;de8c61bed0064e23661723016466690e1efb6208f35c31068a8cc9dca0321fe3&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/de8c61bed006&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;134176d2061456822603fe78391c1e24f6b6024caab0b76487a500b705d634b5&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 0,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们通常容器都是使用后台方式运行的，需要进入容器，修改</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式一</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"><span class="meta">#</span><span class="bash">测试</span></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">7be3b18f55ed   centos    &quot;/bin/sh -c &#x27;while t…&quot;   33 seconds ago   Up 33 seconds             hopeful_brahmagupta</span><br><span class="line">[root@localhost ~]# docker exec -it 7be3b18f55ed /bin/bash</span><br><span class="line">[root@7be3b18f55ed /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 07:21 ?        00:00:00 /bin/sh -c while true;do echo wangkai;sleep 1;done</span><br><span class="line">root        59     0  0 07:21 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        81     1  0 07:22 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line">root        82    59  0 07:22 pts/0    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost ~]# docker attach 7be3b18f55ed</span><br><span class="line">正在执行当前的代码...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span>			<span class="comment"># 进入容器后开启一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach		<span class="comment"># 进入容器正在执行的终端，不会启动新的进程！</span></span></span><br></pre></td></tr></table></figure>
<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id：容器内的路径 目的的主机主机路径</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入docker容器内部</span></span><br><span class="line">[root@localhost /]# docker attach 6028088e9259</span><br><span class="line">[root@6028088e9259 /]# cd /home</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内新建一个文件</span></span><br><span class="line">[root@6028088e9259 home]# touch wangkai.jsx</span><br><span class="line">[root@6028088e9259 home]# ls</span><br><span class="line">wangkai.jsx</span><br><span class="line">[root@6028088e9259 home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@localhost /]# cd /home</span><br><span class="line"><span class="meta">#</span><span class="bash"> 把这文件拷贝出来到主机上</span></span><br><span class="line">[root@localhost home]# docker cp 6028088e9259:/home/wangkai.jsx /home</span><br><span class="line">[root@localhost home]# ls</span><br><span class="line">wangkai.jsx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝是一个手动过程，未来我们使用 -v 卷的技术，可以实现</span></span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.4e00.com%2Fblog%2Fimg%2Flinux%2Fdocker%2Fdocker-commands.png&refer=http%3A%2F%2Fwww.4e00.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1614329119&t=9388ceb58bbb07ac5a802f08816efb6d" alt="img"></p>
<h3 id="练习（安装-nginx）"><a href="#练习（安装-nginx）" class="headerlink" title="练习（安装 nginx）"></a>练习（安装 nginx）</h3><ol>
<li><p>搜索镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br></pre></td></tr></table></figure></li>
<li><p>下载镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure></li>
<li><p>启动容器</p>
<p>![image-20210127170928536](/Users/wk/Library/Application Support/typora-user-images/image-20210127170928536.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx01 -p 3344:80 nginx</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:3344</span><br></pre></td></tr></table></figure></li>
<li><p>进入容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx01 &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3></li>
</ol>
<ul>
<li><p>portainer（先用这个）</p>
<p><a target="_blank" rel="noopener" href="https://documentation.portainer.io/v2.0/deploy/linux/#deploy-portainer-in-docker">https://documentation.portainer.io/v2.0/deploy/linux/#deploy-portainer-in-docker</a></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --name&#x3D;portainer --restart&#x3D;always -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v portainer_data:&#x2F;data portainer&#x2F;portainer-ce</span><br></pre></td></tr></table></figure>
<ul>
<li>Rancher（CI/CD 再用）</li>
</ul>
<p>访问测试：外网 <a target="_blank" rel="noopener" href="http://116.62.234.151:8088/">http://116.62.234.151:8088</a></p>
<p>![image-20210127173346390](/Users/wk/Library/Application Support/typora-user-images/image-20210127173346390.png)</p>
<p>![image-20210128103428336](/Users/wk/Library/Application Support/typora-user-images/image-20210128103428336.png)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/24/essay04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/24/essay04/" class="post-title-link" itemprop="url">前端之docker安装（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-24 17:22:49 / 修改时间：17:24:12" itemprop="dateCreated datePublished" datetime="2021-01-24T17:22:49+08:00">2021-01-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Docker-基本构成"><a href="#Docker-基本构成" class="headerlink" title="Docker 基本构成"></a>Docker 基本构成</h3><p>![image-20210118154001523](/Users/wk/Library/Application Support/typora-user-images/image-20210118154001523.png)</p>
<p>镜像（image）：</p>
<p>Docker 镜像好比是一个模版，可以通过这个模版来创建容器服务，tomcat 镜像===&gt;run===&gt;tomcat01 容器（提供服务器），</p>
<p>通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）</p>
<p>容器（container）：</p>
<p>Docker 利用容器技术，独立运行一个或者一个组应用，通过镜像来创建的。</p>
<p>启动，停止，删除，基本命令！</p>
<p>目前就饿可以把这个容器理解为就是一个简易的 linux 系统</p>
<p>仓库（repository）：</p>
<p>仓库就是存放镜像的地方！</p>
<p>仓库分为公有仓库和私有仓库！</p>
<p>Docker Hub（默认是国外的）</p>
<p>阿里云…都有容器服务器（配置镜像加速！）</p>
<h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h3><blockquote>
<p>环境准备</p>
</blockquote>
<ol>
<li>需要会一点点的 Linux 的基础</li>
<li>CentOS 7</li>
<li>我们使用 Xshell 连接远程服务器进行操作！</li>
</ol>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">系统内核是 3.10 以上的</span><br><span class="line">[root@localhost ~]# uname -r</span><br><span class="line">3.10.0-1127.19.1.el7.x86_64</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">系统版本</span><br><span class="line">[root@localhost ~]# cat &#x2F;etc&#x2F;os-release</span><br><span class="line">NAME&#x3D;&quot;CentOS Linux&quot;</span><br><span class="line">VERSION&#x3D;&quot;7 (Core)&quot;</span><br><span class="line">ID&#x3D;&quot;centos&quot;</span><br><span class="line">ID_LIKE&#x3D;&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID&#x3D;&quot;7&quot;</span><br><span class="line">PRETTY_NAME&#x3D;&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR&#x3D;&quot;0;31&quot;</span><br><span class="line">CPE_NAME&#x3D;&quot;cpe:&#x2F;o:centos:centos:7&quot;</span><br><span class="line">HOME_URL&#x3D;&quot;https:&#x2F;&#x2F;www.centos.org&#x2F;&quot;</span><br><span class="line">BUG_REPORT_URL&#x3D;&quot;https:&#x2F;&#x2F;bugs.centos.org&#x2F;&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT&#x3D;&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION&#x3D;&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT&#x3D;&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION&#x3D;&quot;7&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安装</p>
</blockquote>
<p>帮助文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1、卸载旧的版本</span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line">2、需要的安装包</span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">3、设置镜像的仓库</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">    （默认是国外的！）</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">    （推荐使用阿里云）</span><br><span class="line"></span><br><span class="line">更新yum软件包索引</span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">4、安装docker相关的内容	docker-ce社区版	ee企业版</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">5、启动docker</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">6、使用 doacker version 检测是否安装成功</span><br><span class="line"></span><br><span class="line">7、hello world</span><br><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<p>![image-20210118164206962](/Users/wk/Library/Application Support/typora-user-images/image-20210118164206962.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">8、查看一下下载的这个hello-world镜像</span><br><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    bf756fb1ae65   12 months ago   13.3kB</span><br></pre></td></tr></table></figure>
<h3 id="卸载-docker"><a href="#卸载-docker" class="headerlink" title="卸载 docker"></a>卸载 docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、卸载依赖</span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">2、删除资源</span><br><span class="line">sudo rm -rf &#x2F;var&#x2F;lib&#x2F;docker</span><br><span class="line"></span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;docker  docker的默认工作路径</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/24/essay03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/24/essay03/" class="post-title-link" itemprop="url">前端之docker概述（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-24 17:17:44 / 修改时间：17:22:30" itemprop="dateCreated datePublished" datetime="2021-01-24T17:17:44+08:00">2021-01-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Docker-为什么出现？"><a href="#Docker-为什么出现？" class="headerlink" title="Docker 为什么出现？"></a>Docker 为什么出现？</h3><p>一款产品：开发–上线 两套环境！应用环境，应用配置！</p>
<p>开发 —— 运维。问题：我在我的电脑上可以运行！版本更新，导致服务不可用！对于运维来说，考验就十分大？</p>
<p>环境配置十分麻烦，每一个机器都要部署环境（集群）！费时费力。</p>
<p>发布一个项目（项目+（环境）），项目能不能都带上环境安装打包！</p>
<p>之前在服务器配置一个应用的环境，配置很麻烦，不能够跨平台。</p>
<p>传统：开发项目 运维来做！</p>
<p>现在：开发打包部署上线，一套流程做完！</p>
<p>java – apk – 发布（应用商店） —- 张三使用 apk — 安装即可用！</p>
<p>java — jar（环境） —- 打包项目带上环境（镜像） —- （Docker 仓库：商店） —- 下载我们发布的镜像 — 直接运行即可！</p>
<p>Docker 给以上的问题，提出了方案！</p>
<p>Docker 的思想就来自于集装箱！</p>
<p>多个应用（端口冲突） — 原来都是交叉的！</p>
<p>隔离：Docker 核心思想！打包装修！每个箱子是互相隔离的。</p>
<p>Docker 通过隔离机制，可以将服务器运用到极致！</p>
<p>本质：所有的技术都是因为出现了一些问题，我们需要去解决，去学习！</p>
<h3 id="聊聊-Docker"><a href="#聊聊-Docker" class="headerlink" title="聊聊 Docker"></a>聊聊 Docker</h3><p>Docker 是基于 Go 语言开发的！开源项目！</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>![image-20210118152544649](/Users/wk/Library/Application Support/typora-user-images/image-20210118152544649.png)</p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<p>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h3 id="Docker-能干嘛"><a href="#Docker-能干嘛" class="headerlink" title="Docker 能干嘛"></a>Docker 能干嘛</h3><blockquote>
<p>之前的虚拟机技术</p>
</blockquote>
<p>![image-20210118152837106](/Users/wk/Library/Application Support/typora-user-images/image-20210118152837106.png)</p>
<p>虚拟机技术缺点：</p>
<ol>
<li>资源占用十分多</li>
<li>冗余步骤多</li>
<li>启动很慢！</li>
</ol>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p>容器化技术不是模拟的一个完整的操作系统</p>
<p>![image-20210118153116825](/Users/wk/Library/Application Support/typora-user-images/image-20210118153116825.png)</p>
<p>比较 Docker 和虚拟机技术的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</li>
<li>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了。</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
<blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>更快速的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docker：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用了 Docker 之后，我们部署应用就和搭积木一样！</p>
<p>项目打包为一个镜像，扩展服务器 A！服务器 B</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们的开发，测试环境都是高度一致的。</p>
<p><strong>更高效的计算资源利用</strong></p>
<p>Docker 是内核级别的虚拟化，可以在一个物理机上运行很多容器实例！服务器的性能可以被压榨到极致。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/12/essay02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/essay02/" class="post-title-link" itemprop="url">Nginx常用配置总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-12 10:56:39 / 修改时间：10:58:11" itemprop="dateCreated datePublished" datetime="2021-01-12T10:56:39+08:00">2021-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Nginx常用配置总结"><a href="#Nginx常用配置总结" class="headerlink" title="Nginx常用配置总结"></a>Nginx常用配置总结</h1><h2 id="一、Nginx介绍"><a href="#一、Nginx介绍" class="headerlink" title="一、Nginx介绍"></a>一、Nginx介绍</h2><blockquote>
<p>Nginx是一款面向性能设计的HTTP服务器，能反向代理HTTP，HTTPS和邮件相关（SMTP，POP3，IMAP）的协议链接。并且提供了负载均衡以及HTTP缓存。它的设计充分使用<strong>异步事件</strong>模型，消减上下文调度的开销，提高服务器并发能力。采用了模块化设计，提供了丰富模块的第三方模块。</p>
</blockquote>
<p>所以关于Nginx，有这些标签：「异步」，「事件」，「模块化」，「高性能」，「高并发」，「反向代理」，「负载均衡」</p>
<ul>
<li>Linux系统：Centos 7 x64</li>
<li>Nginx版本：1.11.5</li>
</ul>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><h3 id="2-1-安装依赖"><a href="#2-1-安装依赖" class="headerlink" title="2.1 安装依赖"></a>2.1 安装依赖</h3><blockquote>
<p>prce（重定向支持）和openssl（https支持，如果不需要https可以不安装。）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel </span><br><span class="line">yum -y install gcc make gcc-c++ wget</span><br><span class="line">yum -y install openssl openssl-devel </span><br></pre></td></tr></table></figure>
<h3 id="2-2-下载"><a href="#2-2-下载" class="headerlink" title="2.2 下载"></a>2.2 下载</h3><p>nginx的所有版本都在这里<a target="_blank" rel="noopener" href="http://nginx.org/download/">http://nginx.org/download/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.13.3.tar.gz</span><br><span class="line">wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line"># 如果没有安装wget</span><br><span class="line"># 下载已编译版本</span><br><span class="line">$ yum install wget</span><br><span class="line"></span><br><span class="line"># 解压压缩包</span><br><span class="line">tar zxf nginx-1.13.3.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="2-3-编译安装"><a href="#2-3-编译安装" class="headerlink" title="2.3 编译安装"></a>2.3 编译安装</h3><blockquote>
<p>然后进入目录编译安装，configure参数说明</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.11.5</span><br><span class="line">.&#x2F;configure</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&quot;</span><br><span class="line">  nginx binary file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx&quot;</span><br><span class="line">  nginx modules path: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&quot;</span><br><span class="line">  nginx configuration file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安装报错误的话比如：<code>“C compiler cc is not found”</code>，这个就是缺少编译环境，安装一下就可以了 <strong><code>yum -y install gcc make gcc-c++ openssl-devel</code></strong></p>
</blockquote>
<p>如果没有<code>error</code>信息，就可以执行下边的安装了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h3 id="2-4-nginx测试"><a href="#2-4-nginx测试" class="headerlink" title="2.4 nginx测试"></a>2.4 nginx测试</h3><blockquote>
<p>运行下面命令会出现两个结果，一般情况<code>nginx</code>会安装在<code>/usr/local/nginx</code>目录中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;</span><br><span class="line">.&#x2F;nginx -t</span><br><span class="line"></span><br><span class="line"># nginx: the configuration file &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf syntax is ok</span><br><span class="line"># nginx: configuration file &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf test is successful</span><br></pre></td></tr></table></figure>
<h3 id="2-5-设置全局nginx命令"><a href="#2-5-设置全局nginx命令" class="headerlink" title="2.5 设置全局nginx命令"></a>2.5 设置全局nginx命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将下面内容添加到 <code>~/.bash_profile</code> 文件中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH&#x3D;$PATH:$HOME&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行命令 <strong><code>source ~/.bash_profile</code></strong> 让配置立即生效。你就可以全局运行 <code>nginx</code>命令了。</p>
</blockquote>
<h2 id="三、开机自启动"><a href="#三、开机自启动" class="headerlink" title="三、开机自启动"></a>三、开机自启动</h2><h3 id="开机自启动方法一："><a href="#开机自启动方法一：" class="headerlink" title="开机自启动方法一："></a>开机自启动方法一：</h3><blockquote>
<p>编辑 <strong><code>vi /lib/systemd/system/nginx.service</code></strong> 文件，没有创建一个 <strong><code>touch nginx.service</code></strong> 然后将如下内容根据具体情况进行修改后，添加到<code>nginx.service</code>文件中：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;nginx</span><br><span class="line">After&#x3D;network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">Type&#x3D;forking</span><br><span class="line">PIDFile&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid</span><br><span class="line">ExecStartPre&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -t -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class="line">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp&#x3D;true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<ul>
<li><code>[Unit]</code>:服务的说明</li>
<li><code>Description</code>:描述服务</li>
<li><code>After</code>:描述服务类别</li>
<li><code>[Service]</code>服务运行参数的设置</li>
<li><code>Type=forking</code>是后台运行的形式</li>
<li><code>ExecStart</code>为服务的具体运行命令</li>
<li><code>ExecReload</code>为重启命令</li>
<li><code>ExecStop</code>为停止命令</li>
<li><code>PrivateTmp=True</code>表示给服务分配独立的临时空间</li>
</ul>
<blockquote>
<p><strong>注意</strong>：<code>[Service]</code>的启动、重启、停止命令全部要求使用绝对路径<br><code>[Install]</code>运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为<code>3</code></p>
</blockquote>
<ul>
<li>保存退出。</li>
<li>设置开机启动，使配置生效：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br><span class="line"># 输出下面内容表示成功了</span><br><span class="line">Created symlink from &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;nginx.service to &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service.</span><br></pre></td></tr></table></figure>
<p><strong>开机自启动方法二：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;rc.local</span><br><span class="line"></span><br><span class="line"># 在 rc.local 文件中，添加下面这条命令</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果开机后发现自启动脚本没有执行，你要去确认一下<code>rc.local</code>这个文件的访问权限是否是可执行的，因为<code>rc.local</code>默认是不可执行的。修改<code>rc.local</code>访问权限，增加可执行权限：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x &#x2F;etc&#x2F;rc.d&#x2F;rc.local</span><br></pre></td></tr></table></figure>
<h2 id="四、运维"><a href="#四、运维" class="headerlink" title="四、运维"></a>四、运维</h2><h3 id="4-1-服务管理"><a href="#4-1-服务管理" class="headerlink" title="4.1 服务管理"></a>4.1 服务管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line"></span><br><span class="line"># 重启</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload</span><br><span class="line"></span><br><span class="line"># 关闭进程</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s stop</span><br><span class="line"></span><br><span class="line"># 平滑关闭nginx</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s quit</span><br><span class="line"></span><br><span class="line"># 查看nginx的安装状态，</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -V </span><br></pre></td></tr></table></figure>
<p><strong>关闭防火墙，或者添加防火墙规则就可以测试了</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure>
<p>或者编辑配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加这样一条开放<code>80</code>端口的规则后保存：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>重启服务即可:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># 命令进行查看目前nat</span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure>
<h3 id="4-2-重启服务防火墙报错解决"><a href="#4-2-重启服务防火墙报错解决" class="headerlink" title="4.2 重启服务防火墙报错解决"></a>4.2 重启服务防火墙报错解决</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># Redirecting to &#x2F;bin&#x2F;systemctl restart  iptables.service</span><br><span class="line"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在<code>CentOS 7</code>或<code>RHEL 7</code>或<code>Fedora</code>中防火墙由 <strong><code>firewalld</code></strong> 来管理，当然你可以还原传统的管理方式。或则使用新的命令进行管理。假如采用传统请执行一下命令：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 传统命令</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl mask firewalld</span><br><span class="line"># 安装命令</span><br><span class="line">yum install iptables-services</span><br><span class="line"></span><br><span class="line">systemctl enable iptables </span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<h2 id="五、nginx卸载"><a href="#五、nginx卸载" class="headerlink" title="五、nginx卸载"></a>五、nginx卸载</h2><blockquote>
<p>如果通过<code>yum</code>安装，使用下面命令安装。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>编译安装，删除<code>/usr/local/nginx</code>目录即可</li>
<li>如果配置了自启动脚本，也需要删除。</li>
</ul>
<h2 id="六、参数说明"><a href="#六、参数说明" class="headerlink" title="六、参数说明"></a>六、参数说明</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>--prefix=&lt;path&gt;</code></td>
<td align="left">Nginx安装路径。如果没有指定，默认为 <code>/usr/local/nginx</code>。</td>
</tr>
<tr>
<td align="left"><code>--sbin-path=&lt;path&gt;</code></td>
<td align="left"><code>Nginx</code>可执行文件安装路径。只能安装时指定，如果没有指定，默认为<code>&lt;prefix&gt;/sbin/nginx</code>。</td>
</tr>
<tr>
<td align="left"><code>--conf-path=&lt;path&gt;</code></td>
<td align="left">在没有给定<code>-c</code>选项下默认的<code>nginx.conf</code>的路径。如果没有指定，默认为<code>&lt;prefix&gt;</code>/conf/nginx.conf`。</td>
</tr>
<tr>
<td align="left"><code>--pid-path=&lt;path&gt;</code></td>
<td align="left">在<code>nginx.conf</code>中没有指定pid指令的情况下，默认的<code>nginx.pid</code>的路径。如果没有指定，默认为 <code>&lt;prefix&gt;/logs/nginx.pid</code>。</td>
</tr>
<tr>
<td align="left"><code>--lock-path=&lt;path&gt;</code></td>
<td align="left"><code>nginx.lock</code>文件的路径。</td>
</tr>
<tr>
<td align="left"><code>--error-log-path=&lt;path&gt;</code></td>
<td align="left">在<code>nginx.conf</code>中没有指定<code>error_log</code>指令的情况下，默认的错误日志的路径。如果没有指定，默认为 <code>&lt;prefix&gt;/- logs/error.log</code>。</td>
</tr>
<tr>
<td align="left"><code>--http-log-path=&lt;path&gt;</code></td>
<td align="left">在<code>nginx.conf</code>中没有指定<code>access_log</code>指令的情况下，默认的访问日志的路径。如果没有指定，默认为 <code>&lt;prefix&gt;/- logs/access.log</code>。</td>
</tr>
<tr>
<td align="left"><code>--user=&lt;user&gt;</code></td>
<td align="left">在<code>nginx.conf</code>中没有指定<code>user</code>指令的情况下，默认的<code>nginx</code>使用的用户。如果没有指定，默认为 <code>nobody</code>。</td>
</tr>
<tr>
<td align="left"><code>--group=&lt;group&gt;</code></td>
<td align="left">在<code>nginx.conf</code>中没有指定<code>user</code>指令的情况下，默认的<code>nginx</code>使用的组。如果没有指定，默认为 <code>nobody</code>。</td>
</tr>
<tr>
<td align="left"><code>--builddir=DIR</code></td>
<td align="left">指定编译的目录</td>
</tr>
<tr>
<td align="left"><code>--with-rtsig_module</code></td>
<td align="left">启用 <code>rtsig</code> 模块</td>
</tr>
<tr>
<td align="left"><code>--with-select_module --without-select_module</code></td>
<td align="left">允许或不允许开启<code>SELECT</code>模式，如果<code>configure</code> 没有找到更合适的模式，比如：<code>kqueue(sun os)</code>,<code>epoll (linux kenel 2.6+)</code>,<code>rtsig(- 实时信号)</code>或者<code>/dev/poll</code>(一种类似select的模式，底层实现与SELECT基本相 同，都是采用轮训方法) SELECT模式将是默认安装模式</td>
</tr>
<tr>
<td align="left"><code>--with-poll_module --without-poll_module</code></td>
<td align="left">Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.</td>
</tr>
<tr>
<td align="left"><code>--with-http_ssl_module</code></td>
<td align="left">Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. 开启HTTP SSL模块，使NGINX可以支持HTTPS请求。这个模块需要已经安装了OPENSSL，在DEBIAN上是libssl</td>
</tr>
<tr>
<td align="left"><code>--with-http_realip_module</code></td>
<td align="left">启用 <code>ngx_http_realip_module</code></td>
</tr>
<tr>
<td align="left"><code>--with-http_addition_module</code></td>
<td align="left">启用 <code>ngx_http_addition_module</code></td>
</tr>
<tr>
<td align="left"><code>--with-http_sub_module</code></td>
<td align="left">启用 <code>ngx_http_sub_module</code></td>
</tr>
<tr>
<td align="left"><code>--with-http_dav_module</code></td>
<td align="left">启用 <code>ngx_http_dav_module</code></td>
</tr>
<tr>
<td align="left"><code>--with-http_flv_module</code></td>
<td align="left">启用 <code>ngx_http_flv_module</code></td>
</tr>
<tr>
<td align="left"><code>--with-http_stub_status_module</code></td>
<td align="left">启用 <code>&quot;server status&quot;</code>页</td>
</tr>
<tr>
<td align="left"><code>--without-http_charset_module</code></td>
<td align="left">禁用 <code>ngx_http_charset_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_gzip_module</code></td>
<td align="left">禁用 <code>ngx_http_gzip_module</code>. 如果启用，需要 zlib 。</td>
</tr>
<tr>
<td align="left"><code>--without-http_ssi_module</code></td>
<td align="left">禁用 <code>ngx_http_ssi_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_userid_module</code></td>
<td align="left">禁用 <code>ngx_http_userid_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_access_module</code></td>
<td align="left">禁用 <code>ngx_http_access_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_auth_basic_module</code></td>
<td align="left">禁用 <code>ngx_http_auth_basic_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_autoindex_module</code></td>
<td align="left">禁用 <code>ngx_http_autoindex_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_geo_module</code></td>
<td align="left">禁用 <code>ngx_http_geo_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_map_module</code></td>
<td align="left">禁用 <code>ngx_http_map_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_referer_module</code></td>
<td align="left">禁用 <code>ngx_http_referer_module</code></td>
</tr>
<tr>
<td align="left"><code>--without-http_rewrite_module</code></td>
<td align="left">禁用 <code>ngx_http_rewrite_module.</code> 如果启用需要<code>PCRE</code> 。</td>
</tr>
<tr>
<td align="left"><code>--without-http_proxy_module</code></td>
<td align="left">禁用 ngx_http_proxy_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_fastcgi_module</code></td>
<td align="left">禁用 ngx_http_fastcgi_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_memcached_module</code></td>
<td align="left">禁用 ngx_http_memcached_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_limit_zone_module</code></td>
<td align="left">禁用 ngx_http_limit_zone_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_empty_gif_module</code></td>
<td align="left">禁用 ngx_http_empty_gif_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_browser_module</code></td>
<td align="left">禁用 ngx_http_browser_module</td>
</tr>
<tr>
<td align="left"><code>--without-http_upstream_ip_hash_module</code></td>
<td align="left">禁用 ngx_http_upstream_ip_hash_module`</td>
</tr>
<tr>
<td align="left"><code>--with-http_perl_module</code></td>
<td align="left">启用 ngx_http_perl_module</td>
</tr>
<tr>
<td align="left"><code>--with-perl_modules_path=PATH</code></td>
<td align="left">指定 perl 模块的路径</td>
</tr>
<tr>
<td align="left"><code>--with-perl=PATH</code></td>
<td align="left">指定 perl 执行文件的路径</td>
</tr>
<tr>
<td align="left"><code>--http-log-path=PATH</code></td>
<td align="left">Set path to the http access log</td>
</tr>
<tr>
<td align="left"><code>--http-client-body-temp-path=PATH</code></td>
<td align="left">Set path to the http client request body temporary files</td>
</tr>
<tr>
<td align="left"><code>--http-proxy-temp-path=PATH</code></td>
<td align="left">Set path to the http proxy temporary files</td>
</tr>
<tr>
<td align="left"><code>--http-fastcgi-temp-path=PATH</code></td>
<td align="left">Set path to the http fastcgi temporary files</td>
</tr>
<tr>
<td align="left"><code>--without-http</code></td>
<td align="left">禁用 HTTP server</td>
</tr>
<tr>
<td align="left"><code>--with-mail</code></td>
<td align="left">启用 IMAP4/POP3/SMTP 代理模块</td>
</tr>
<tr>
<td align="left"><code>--with-mail_ssl_module</code></td>
<td align="left">启用 ngx_mail_ssl_module</td>
</tr>
<tr>
<td align="left"><code>--with-cc=PATH</code></td>
<td align="left">指定 C 编译器的路径</td>
</tr>
<tr>
<td align="left"><code>--with-cpp=PATH</code></td>
<td align="left">指定 C 预处理器的路径</td>
</tr>
<tr>
<td align="left"><code>--with-cc-opt=OPTIONS</code></td>
<td align="left">Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate –with-cc-opt=”-I /usr/local/include”. If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: –with-cc-opt=”-D FD_SETSIZE=2048”.</td>
</tr>
<tr>
<td align="left"><code>--with-ld-opt=OPTIONS</code></td>
<td align="left">Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate –with-ld-opt=”-L /usr/local/lib”.</td>
</tr>
<tr>
<td align="left"><code>--with-cpu-opt=CPU</code></td>
<td align="left">为特定的 CPU 编译，有效的值包括：pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td>
</tr>
<tr>
<td align="left"><code>--without-pcre</code></td>
<td align="left">禁止 PCRE 库的使用。同时也会禁止 HTTP rewrite 模块。在 “location” 配置指令中的正则表达式也需要 PCRE 。</td>
</tr>
<tr>
<td align="left"><code>--with-pcre=DIR</code></td>
<td align="left">指定 PCRE 库的源代码的路径。</td>
</tr>
<tr>
<td align="left"><code>--with-pcre-opt=OPTIONS</code></td>
<td align="left">Set additional options for PCRE building.</td>
</tr>
<tr>
<td align="left"><code>--with-md5=DIR</code></td>
<td align="left">Set path to md5 library sources.</td>
</tr>
<tr>
<td align="left"><code>--with-md5-opt=OPTIONS</code></td>
<td align="left">Set additional options for md5 building.</td>
</tr>
<tr>
<td align="left"><code>--with-md5-asm</code></td>
<td align="left">Use md5 assembler sources.</td>
</tr>
<tr>
<td align="left"><code>--with-sha1=DIR</code></td>
<td align="left">Set path to sha1 library sources.</td>
</tr>
<tr>
<td align="left"><code>--with-sha1-opt=OPTIONS</code></td>
<td align="left">Set additional options for sha1 building.</td>
</tr>
<tr>
<td align="left"><code>--with-sha1-asm</code></td>
<td align="left">Use sha1 assembler sources.</td>
</tr>
<tr>
<td align="left"><code>--with-zlib=DIR</code></td>
<td align="left">Set path to zlib library sources.</td>
</tr>
<tr>
<td align="left"><code>--with-zlib-opt=OPTIONS</code></td>
<td align="left">Set additional options for zlib building.</td>
</tr>
<tr>
<td align="left"><code>--with-zlib-asm=CPU</code></td>
<td align="left">Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td>
</tr>
<tr>
<td align="left"><code>--with-openssl=DIR</code></td>
<td align="left">Set path to OpenSSL library sources</td>
</tr>
<tr>
<td align="left"><code>--with-openssl-opt=OPTIONS</code></td>
<td align="left">Set additional options for OpenSSL building</td>
</tr>
<tr>
<td align="left"><code>--with-debug</code></td>
<td align="left">启用调试日志</td>
</tr>
<tr>
<td align="left"><code>--add-module=PATH</code></td>
<td align="left">Add in a third-party module found in directory PATH</td>
</tr>
</tbody></table>
<h2 id="七、配置"><a href="#七、配置" class="headerlink" title="七、配置"></a>七、配置</h2><blockquote>
<p>在<code>Centos</code> 默认配置文件在 <strong><code>/usr/local/nginx-1.5.1/conf/nginx.conf</code></strong> 我们要在这里配置一些文件。<code>nginx.conf</code>是主配置文件，由若干个部分组成，每个大括号<code>&#123;&#125;</code>表示一个部分。每一行指令都由分号结束<code>;</code>，标志着一行的结束。</p>
</blockquote>
<h3 id="7-1-常用正则"><a href="#7-1-常用正则" class="headerlink" title="7.1 常用正则"></a>7.1 常用正则</h3><table>
<thead>
<tr>
<th align="left">正则</th>
<th align="left">说明</th>
<th align="left">正则</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>.</code></td>
<td align="left">匹配除换行符以外的任意字符</td>
<td align="left"><code>$</code></td>
<td align="left">匹配字符串的结束</td>
</tr>
<tr>
<td align="left"><code>?</code></td>
<td align="left">重复<code>0</code>次或<code>1</code>次</td>
<td align="left"><code>&#123;n&#125;</code></td>
<td align="left">重复<code>n</code>次</td>
</tr>
<tr>
<td align="left"><code>+</code></td>
<td align="left">重复<code>1</code>次或更多次</td>
<td align="left"><code>&#123;n,&#125;</code></td>
<td align="left">重复<code>n</code>次或更多次</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left">重复<code>0</code>次或更多次</td>
<td align="left"><code>[c]</code></td>
<td align="left">匹配单个字符<code>c</code></td>
</tr>
<tr>
<td align="left"><code>\d</code></td>
<td align="left">匹配数字</td>
<td align="left"><code>[a-z]</code></td>
<td align="left">匹配<code>a-z</code>小写字母的任意一个</td>
</tr>
<tr>
<td align="left"><code>^</code></td>
<td align="left">匹配字符串的开始</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<h3 id="7-2-全局变量"><a href="#7-2-全局变量" class="headerlink" title="7.2 全局变量"></a>7.2 全局变量</h3><table>
<thead>
<tr>
<th align="left">变量</th>
<th align="left">说明</th>
<th align="left">变量</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args</code></td>
<td align="left">这个变量等于请求行中的参数，同<code>$query_string</code></td>
<td align="left"><code>$remote_port</code></td>
<td align="left">客户端的端口。</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">请求头中的<code>Content-length</code>字段。</td>
<td align="left"><code>$remote_user</code></td>
<td align="left">已经经过<code>Auth Basic Module</code>验证的用户名。</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">请求头中的<code>Content-Type</code>字段。</td>
<td align="left"><code>$request_filename</code></td>
<td align="left">当前请求的文件路径，由<code>root</code>或<code>alias</code>指令与<code>URI</code>请求生成。</td>
</tr>
<tr>
<td align="left"><code>$document_root</code></td>
<td align="left">当前请求在<code>root</code>指令中指定的值。</td>
<td align="left"><code>$scheme</code></td>
<td align="left"><code>HTTP</code>方法（如<code>http</code>，<code>https</code>）。</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">请求主机头字段，否则为服务器名称。</td>
<td align="left"><code>$server_protocol</code></td>
<td align="left">请求使用的协议，通常是<code>HTTP/1.0</code>或<code>HTTP/1.1</code>。</td>
</tr>
<tr>
<td align="left"><code>$http_user_agent</code></td>
<td align="left">客户端<code>agent</code>信息</td>
<td align="left"><code>$server_addr</code></td>
<td align="left">服务器地址，在完成一次系统调用后可以确定这个值。</td>
</tr>
<tr>
<td align="left"><code>$http_cookie</code></td>
<td align="left">客户端<code>cookie</code>信息</td>
<td align="left"><code>$server_name</code></td>
<td align="left">服务器名称。</td>
</tr>
<tr>
<td align="left"><code>$limit_rate</code></td>
<td align="left">这个变量可以限制连接速率。</td>
<td align="left"><code>$server_port</code></td>
<td align="left">请求到达服务器的端口号。</td>
</tr>
<tr>
<td align="left"><code>$request_method</code></td>
<td align="left">客户端请求的动作，通常为<code>GET</code>或<code>POST</code>。</td>
<td align="left"><code>$request_uri</code></td>
<td align="left">包含请求参数的原始<code>URI</code>，不包含主机名，如：<code>/foo/bar.php?arg=baz</code>。</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">客户端的<code>IP</code>地址。</td>
<td align="left"><code>$uri</code></td>
<td align="left">不带请求参数的当前<code>URI</code>，<code>$uri</code>不包含主机名，如<code>/foo/bar.html</code>。</td>
</tr>
<tr>
<td align="left"><code>$document_uri</code></td>
<td align="left">与$uri`相同。</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<blockquote>
<p>例如请求：<code>http://localhost:3000/test1/test2/test.php</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$host：localhost  </span><br><span class="line">$server_port：3000  </span><br><span class="line">$request_uri：&#x2F;test1&#x2F;test2&#x2F;test.php  </span><br><span class="line">$document_uri：&#x2F;test1&#x2F;test2&#x2F;test.php  </span><br><span class="line">$document_root：&#x2F;var&#x2F;www&#x2F;html  </span><br><span class="line">$request_filename：&#x2F;var&#x2F;www&#x2F;html&#x2F;test1&#x2F;test2&#x2F;test.php  </span><br></pre></td></tr></table></figure>
<h3 id="7-3-符号参考"><a href="#7-3-符号参考" class="headerlink" title="7.3 符号参考"></a>7.3 符号参考</h3><table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">说明</th>
<th align="left">符号</th>
<th align="left">说明</th>
<th align="left">符号</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>k</code>,<code>K</code></td>
<td align="left">千字节</td>
<td align="left"><code>m</code>,<code>M</code></td>
<td align="left">兆字节</td>
<td align="left"><code>ms</code></td>
<td align="left">毫秒</td>
</tr>
<tr>
<td align="left"><code>s</code></td>
<td align="left">秒</td>
<td align="left"><code>m</code></td>
<td align="left">分钟</td>
<td align="left"><code>h</code></td>
<td align="left">小时</td>
</tr>
<tr>
<td align="left"><code>d</code></td>
<td align="left">日</td>
<td align="left"><code>w</code></td>
<td align="left">周</td>
<td align="left"><code>M</code></td>
<td align="left">一个月, <code>30</code>天</td>
</tr>
</tbody></table>
<p>例如，”8k”，”1m” 代表字节数计量。<br>例如，”1h 30m”，”1y 6M”。代表 “1小时 30分”，”1年零6个月”。</p>
<h3 id="7-4-配置文件"><a href="#7-4-配置文件" class="headerlink" title="7.4 配置文件"></a>7.4 配置文件</h3><blockquote>
<p><code>nginx</code> 的配置系统由一个主配置文件和其他一些辅助的配置文件构成。这些配置文件均是纯文本文件，全部位于 <code>nginx</code> 安装目录下的 <code>conf</code> 目录下。</p>
</blockquote>
<ul>
<li>指令由 <code>nginx</code> 的各个模块提供，不同的模块会提供不同的指令来实现配置。指令除了<code>Key-Value</code> 的形式，还有作用域指令。</li>
<li><code>nginx.conf</code> 中的配置信息，根据其逻辑上的意义，对它们进行了分类，也就是分成了多个作用域，或者称之为配置指令上下文。不同的作用域含有一个或者多个配置项。</li>
</ul>
<p><strong>下面的这些上下文指令用的比较多</strong></p>
<table>
<thead>
<tr>
<th align="left">Directive</th>
<th align="left">Description</th>
<th align="left">Contains Directive</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>main</code></td>
<td align="left"><code>nginx</code> 在运行时与具体业务功能（比如 <code>http</code> 服务或者 <code>email</code> 服务代理）无关的一些参数，比如工作进程数，运行的身份等。</td>
<td align="left"><code>user</code>, <code>worker_processes</code>, <code>error_log</code>, <code>events</code>, <code>http</code>, <code>mail</code></td>
</tr>
<tr>
<td align="left"><code>http</code></td>
<td align="left">与提供 <code>http</code> 服务相关的一些配置参数。例如：是否使用 <code>keepalive</code> 啊，是否使用 <code>gzip</code> 进行压缩等。</td>
<td align="left"><code>server</code></td>
</tr>
<tr>
<td align="left"><code>server</code></td>
<td align="left"><code>http</code> 服务支持若干虚拟主机。每个虚拟主机一个对应的 <code>server</code> 配置项，配置项里面包含该虚拟主机相关的配置。在提供 <code>mail</code> 服务的代理时，也可以建立若干 <code>server</code>. 每个 <code>server</code> 通过监听的地址来区分。</td>
<td align="left"><code>listen</code>, <code>server_name</code>, <code>access_log</code>, <code>location</code>, <code>protocol</code>, <code>proxy</code>, <code>smtp_auth</code>, <code>xclient</code></td>
</tr>
<tr>
<td align="left"><code>location</code></td>
<td align="left"><code>http</code> 服务中，某些特定的 <code>URL</code>对应的一系列配置项。</td>
<td align="left"><code>index</code>, <code>root</code></td>
</tr>
<tr>
<td align="left"><code>mail</code></td>
<td align="left">实现 <code>email</code> 相关的 <code>SMTP/IMAP/POP3</code> 代理时，共享的一些配置项（因为可能实现多个代理，工作在多个监听地址上）。</td>
<td align="left"><code>server</code>, <code>http</code>,<code>imap_capabilities</code></td>
</tr>
<tr>
<td align="left"><code>include</code></td>
<td align="left">以便增强配置文件的可读性，使得部分配置文件可以重新使用。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>valid_referers</code></td>
<td align="left">用来校验<code>Http</code>请求头<code>Referer</code>是否有效。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>try_files</code></td>
<td align="left">用在<code>server</code>部分，不过最常见的还是用在<code>location</code>部分，它会按照给定的参数顺序进行尝试，第一个被匹配到的将会被使用。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>if</code></td>
<td align="left">当在<code>location</code>块中使用<code>if</code>指令，在某些情况下它并不按照预期运行，一般来说避免使用if指令。</td>
<td align="left">-</td>
</tr>
</tbody></table>
<blockquote>
<p>例如我们在 <strong><code>nginx.conf</code></strong> 里面引用两个配置 <code>vhost/example.com.conf</code> 和 <code>vhost/gitlab.com.conf</code> 它们都被放在一个我自己新建的目录 <code>vhost</code> 下面。<code>nginx.conf</code> 配置如下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    include  vhost&#x2F;example.com.conf;</span><br><span class="line">    include  vhost&#x2F;gitlab.com.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>简单的配置: <code>example.com.conf</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  baidu.com app.baidu.com; # 这里指定域名</span><br><span class="line">    index        index.html index.htm;    # 这里指定默认入口页面</span><br><span class="line">    root &#x2F;home&#x2F;www&#x2F;app.baidu.com;         # 这里指定目录</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-5-内置预定义变量"><a href="#7-5-内置预定义变量" class="headerlink" title="7.5 内置预定义变量"></a>7.5 内置预定义变量</h3><blockquote>
<p><code>Nginx</code>提供了许多预定义的变量，也可以通过使用set来设置变量。你可以在<code>if</code>中使用预定义变量，也可以将它们传递给代理服务器。以下是一些常见的预定义变量，更多详见</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">变量名称</th>
<th align="left">值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args_name</code></td>
<td align="left">在请求中的<code>name</code>参数</td>
</tr>
<tr>
<td align="left"><code>$args</code></td>
<td align="left">所有请求参数</td>
</tr>
<tr>
<td align="left"><code>$query_string</code></td>
<td align="left"><code>$args</code>的别名</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">请求头<code>Content-Length</code>的值</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">请求头<code>Content-Type</code>的值</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">如果当前有<code>Host</code>，则为请求头<code>Host</code>的值；如果没有这个头，那么该值等于匹配该请求的<code>server_name</code>的值</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">客户端的IP地址</td>
</tr>
<tr>
<td align="left"><code>$request</code></td>
<td align="left">完整的请求，从客户端收到，包括<code>Http</code>请求方法、<code>URI</code>、<code>Http</code>协议、头、请求体</td>
</tr>
<tr>
<td align="left"><code>$request_uri</code></td>
<td align="left">完整请求的<code>URI</code>，从客户端来的请求，包括参数</td>
</tr>
<tr>
<td align="left"><code>$scheme</code></td>
<td align="left">当前请求的协议</td>
</tr>
<tr>
<td align="left"><code>$uri</code></td>
<td align="left">当前请求的标准化<code>URI</code></td>
</tr>
</tbody></table>
<h3 id="7-6-反向代理"><a href="#7-6-反向代理" class="headerlink" title="7.6 反向代理"></a>7.6 反向代理</h3><blockquote>
<p>反向代理是一个<code>Web</code>服务器，它接受客户端的连接请求，然后将请求转发给上游服务器，并将从服务器得到的结果返回给连接的客户端。下面简单的反向代理的例子：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen       80;</span><br><span class="line">  server_name  localhost;</span><br><span class="line">  client_max_body_size 1024M;  # 允许客户端请求的最大单文件字节数</span><br><span class="line"></span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    proxy_pass                         http:&#x2F;&#x2F;localhost:8080;</span><br><span class="line">    proxy_set_header Host              $host:$server_port;</span><br><span class="line">    proxy_set_header X-Forwarded-For   $remote_addr; # HTTP的请求端真实的IP</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;      # 为了正确地识别实际用户发出的协议是 http 还是 https</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>复杂的配置: <code>gitlab.com.conf</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass   http:&#x2F;&#x2F;localhost:3000;</span><br><span class="line">        #以下是一些反向代理的配置可删除</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        client_max_body_size       10m; #允许客户端请求的最大单文件字节数</span><br><span class="line">        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">        proxy_connect_timeout      300; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">        proxy_send_timeout         300; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">        proxy_read_timeout         300; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">        proxy_buffers              4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代理到上游服务器的配置中，最重要的是<code>proxy_pass</code>指令。以下是代理模块中的一些常用指令：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">指令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>proxy_connect_timeout</code></td>
<td align="left"><code>Nginx</code>从接受请求至连接到上游服务器的最长等待时间</td>
</tr>
<tr>
<td align="left"><code>proxy_send_timeout</code></td>
<td align="left">后端服务器数据回传时间(代理发送超时)</td>
</tr>
<tr>
<td align="left"><code>proxy_read_timeout</code></td>
<td align="left">连接成功后，后端服务器响应时间(代理接收超时)</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_domain</code></td>
<td align="left">替代从上游服务器来的<code>Set-Cookie</code>头的<code>domain</code>属性</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_path</code></td>
<td align="left">替代从上游服务器来的<code>Set-Cookie</code>头的<code>path</code>属性</td>
</tr>
<tr>
<td align="left"><code>proxy_buffer_size</code></td>
<td align="left">设置代理服务器（<code>nginx</code>）保存用户头信息的缓冲区大小</td>
</tr>
<tr>
<td align="left"><code>proxy_buffers</code></td>
<td align="left"><code>proxy_buffers</code>缓冲区，网页平均在多少<code>k</code>以下</td>
</tr>
<tr>
<td align="left"><code>proxy_set_header</code></td>
<td align="left">重写发送到上游服务器头的内容，也可以通过将某个头部的值设置为空字符串，而不发送某个头部的方法实现</td>
</tr>
<tr>
<td align="left"><code>proxy_ignore_headers</code></td>
<td align="left">这个指令禁止处理来自代理服务器的应答。</td>
</tr>
<tr>
<td align="left"><code>proxy_intercept_errors</code></td>
<td align="left">使<code>nginx</code>阻止<code>HTTP</code>应答代码为400或者更高的应答。</td>
</tr>
</tbody></table>
<h3 id="7-7-负载均衡"><a href="#7-7-负载均衡" class="headerlink" title="7.7 负载均衡"></a>7.7 负载均衡</h3><blockquote>
<p><code>upstream</code>指令启用一个新的配置区段，在该区段定义一组上游服务器。这些服务器可能被设置不同的权重，也可能出于对服务器进行维护，标记为<code>down</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">upstream gitlab &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    # upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span><br><span class="line">    server 192.168.122.11:8081 ;</span><br><span class="line">    server 127.0.0.1:82 weight&#x3D;3;</span><br><span class="line">    server 127.0.0.1:83 weight&#x3D;3 down;</span><br><span class="line">    server 127.0.0.1:84 weight&#x3D;3; max_fails&#x3D;3  fail_timeout&#x3D;20s;</span><br><span class="line">    server 127.0.0.1:85 weight&#x3D;4;;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass   http:&#x2F;&#x2F;gitlab;    #在这里设置一个代理，和upstream的名字一样</span><br><span class="line">        #以下是一些反向代理的配置可删除</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        proxy_set_header           X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size       10m;  #允许客户端请求的最大单文件字节数</span><br><span class="line">        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">        proxy_connect_timeout      300;  #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">        proxy_send_timeout         300;  #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">        proxy_read_timeout         300;  #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">        proxy_buffers              4 32k;# 缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">        proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器<code>down</code>掉，能自动剔除。</p>
</blockquote>
<p><strong>负载均衡：</strong></p>
<p><code>upstream</code>模块能够使用3种负载均衡算法：轮询、<code>IP</code>哈希、最少连接数。</p>
<p><strong>轮询：</strong> 默认情况下使用轮询算法，不需要配置指令来激活它，它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器；<br><strong>IP哈希：</strong> 通过<code>ip_hash</code>指令来激活，<code>Nginx</code>通过<code>IPv4</code>地址的前<code>3</code>个字节或者整个<code>IPv6</code>地址作为哈希键来实现，同一个IP地址总是能被映射到同一个上游服务器；<br><strong>最少连接数：</strong> 通过<code>least_conn</code>指令来激活，该算法通过选择一个活跃数最少的上游服务器进行连接。如果上游服务器处理能力不同，可以通过给<code>server</code>配置<code>weight</code>权重来说明，该算法将考虑到不同服务器的加权最少连接数。</p>
<h4 id="7-7-1-RR"><a href="#7-7-1-RR" class="headerlink" title="7.7.1 RR"></a>7.7.1 RR</h4><p><strong>简单配置</strong> ，这里我配置了<code>2</code>台服务器，当然实际上是一台，只是端口不一样而已，而<code>8081</code>的服务器是不存在的，也就是说访问不到，但是我们访问 <code>http://localhost</code> 的时候，也不会有问题，会默认跳转到<code>http://localhost:8080</code>具体是因为Nginx会自动判断服务器的状态，如果服务器处于不能访问（服务器挂了），就不会跳转到这台服务器，所以也避免了一台服务器挂了影响使用的情况，由于Nginx默认是RR策略，所以我们不需要其他更多的设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       81;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    client_max_body_size 1024M;</span><br><span class="line"> </span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;test;</span><br><span class="line">        proxy_set_header Host $host:$server_port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>负载均衡的核心代码为</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-7-2-权重"><a href="#7-7-2-权重" class="headerlink" title="7.7.2 权重"></a>7.7.2 权重</h4><blockquote>
<p>指定轮询几率，<code>weight</code>和访问比率成正比，用于后端服务器性能不均的情况。例如</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080 weight&#x3D;9;</span><br><span class="line">    server localhost:8081 weight&#x3D;1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>那么<code>10</code>次一般只会有<code>1</code>次会访问到<code>8081</code>，而有<code>9</code>次会访问到<code>8080</code></p>
</blockquote>
<h4 id="7-7-3-ip-hash"><a href="#7-7-3-ip-hash" class="headerlink" title="7.7.3 ip_hash"></a>7.7.3 ip_hash</h4><blockquote>
<p>上面的2种方式都有一个问题，那就是下一个请求来的时候请求可能分发到另外一个服务器，当我们的程序不是无状态的时候（采用了<code>session</code>保存数据），这时候就有一个很大的很问题了，比如把登录信息保存到了<code>session</code>中，那么跳转到另外一台服务器的时候就需要重新登录了，所以很多时候我们需要一个客户只访问一个服务器，那么就需要用<code>iphash</code>了，<code>iphash</code>的每个请求按访问<code>ip</code>的<code>hash</code>结果分配，这样每个访客固定访问一个后端服务器，可以解决<code>session</code>的问题。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-7-4-fair"><a href="#7-7-4-fair" class="headerlink" title="7.7.4 fair"></a>7.7.4 fair</h4><blockquote>
<p>这是个第三方模块，按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    fair;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-7-5-url-hash"><a href="#7-7-5-url-hash" class="headerlink" title="7.7.5 url_hash"></a>7.7.5 url_hash</h4><blockquote>
<p>这是个第三方模块，按访问<code>url</code>的<code>hash</code>结果来分配请求，使每个<code>url</code>定向到同一个后端服务器，后端服务器为缓存时比较有效。在<code>upstream</code>中加入<code>hash</code>语句，<code>server</code>语句中不能写入<code>weight</code>等其他的参数，<code>hash_method</code>是使用的<code>hash</code>算法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上<code>5</code>种负载均衡各自适用不同情况下使用，所以可以根据实际情况选择使用哪种策略模式，不过<code>fair</code>和<code>url_hash</code>需要安装第三方模块才能使用</p>
</blockquote>
<p><strong>server指令可选参数：</strong></p>
<ol>
<li><code>weight</code>：设置一个服务器的访问权重，数值越高，收到的请求也越多；</li>
<li><code>fail_timeout</code>：在这个指定的时间内服务器必须提供响应，如果在这个时间内没有收到响应，那么服务器将会被标记为<code>down</code>状态；</li>
<li><code>max_fails</code>：设置在<code>fail_timeout</code>时间之内尝试对一个服务器连接的最大次数，如果超过这个次数，那么服务器将会被标记为<code>down</code>;</li>
<li><code>down</code>：标记一个服务器不再接受任何请求；</li>
<li><code>backup</code>：一旦其他服务器宕机，那么有该标记的机器将会接收请求。</li>
</ol>
<p><strong>keepalive指令：</strong></p>
<blockquote>
<p><code>Nginx</code>服务器将会为每一个<code>worker</code>进行保持同上游服务器的连接。</p>
</blockquote>
<h3 id="7-8-屏蔽ip"><a href="#7-8-屏蔽ip" class="headerlink" title="7.8 屏蔽ip"></a>7.8 屏蔽ip</h3><blockquote>
<p>在<code>nginx</code>的配置文件<code>nginx.conf</code>中加入如下配置，可以放到<code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code>语句块，需要注意相对路径，本例当中<code>nginx.conf</code>，<code>blocksip.conf</code>在同一个目录中。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include blockip.conf;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在<code>blockip.conf</code>里面输入内容，如：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deny 165.91.122.67;</span><br><span class="line"></span><br><span class="line">deny IP;   # 屏蔽单个ip访问</span><br><span class="line">allow IP;  # 允许单个ip访问</span><br><span class="line">deny all;  # 屏蔽所有ip访问</span><br><span class="line">allow all; # 允许所有ip访问</span><br><span class="line">deny 123.0.0.0&#x2F;8   # 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span><br><span class="line">deny 124.45.0.0&#x2F;16 # 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span><br><span class="line">deny 123.45.6.0&#x2F;24 # 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span><br><span class="line"></span><br><span class="line"># 如果你想实现这样的应用，除了几个IP外，其他全部拒绝</span><br><span class="line">allow 1.1.1.1;</span><br><span class="line">allow 1.1.1.2;</span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure>
<h2 id="八、第三方模块安装方法"><a href="#八、第三方模块安装方法" class="headerlink" title="八、第三方模块安装方法"></a>八、第三方模块安装方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;你的安装目录  --add-module&#x3D;&#x2F;第三方模块目录</span><br></pre></td></tr></table></figure>
<h2 id="九、重定向"><a href="#九、重定向" class="headerlink" title="九、重定向"></a>九、重定向</h2><ul>
<li><code>permanent</code> 永久性重定向。请求日志中的状态码为301</li>
<li><code>redirect</code> 临时重定向。请求日志中的状态码为302</li>
</ul>
<h3 id="9-1-重定向整个网站"><a href="#9-1-重定向整个网站" class="headerlink" title="9.1 重定向整个网站"></a>9.1 重定向整个网站</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name old-site.com</span><br><span class="line">    return 301 $scheme:&#x2F;&#x2F;new-site.com$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-2-重定向单页"><a href="#9-2-重定向单页" class="headerlink" title="9.2 重定向单页"></a>9.2 重定向单页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location &#x3D; &#x2F;oldpage.html &#123;</span><br><span class="line">        return 301 http:&#x2F;&#x2F;example.org&#x2F;newpage.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-3-重定向整个子路径"><a href="#9-3-重定向整个子路径" class="headerlink" title="9.3 重定向整个子路径"></a>9.3 重定向整个子路径</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;old-site &#123;</span><br><span class="line">    rewrite ^&#x2F;old-site&#x2F;(.*) http:&#x2F;&#x2F;example.org&#x2F;new-site&#x2F;$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十、性能"><a href="#十、性能" class="headerlink" title="十、性能"></a>十、性能</h2><h3 id="10-1-内容缓存"><a href="#10-1-内容缓存" class="headerlink" title="10.1 内容缓存"></a>10.1 内容缓存</h3><blockquote>
<p>允许浏览器基本上永久地缓存静态内容。<code>Nginx</code>将为您设置<code>Expires</code>和<code>Cache-Control</code>头信息。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;static &#123;</span><br><span class="line">    root &#x2F;data;</span><br><span class="line">    expires max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要求浏览器永远不会缓存响应（例如用于跟踪请求），请使用<code>-1</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location &#x3D; &#x2F;empty.gif &#123;</span><br><span class="line">    empty_gif;</span><br><span class="line">    expires -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-Gzip压缩"><a href="#10-2-Gzip压缩" class="headerlink" title="10.2 Gzip压缩"></a>10.2 Gzip压缩</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gzip  on;</span><br><span class="line">gzip_buffers 16 8k;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line">gzip_min_length 256;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_types</span><br><span class="line">    text&#x2F;xml application&#x2F;xml application&#x2F;atom+xml application&#x2F;rss+xml application&#x2F;xhtml+xml image&#x2F;svg+xml</span><br><span class="line">    text&#x2F;javascript application&#x2F;javascript application&#x2F;x-javascript</span><br><span class="line">    text&#x2F;x-json application&#x2F;json application&#x2F;x-web-app-manifest+json</span><br><span class="line">    text&#x2F;css text&#x2F;plain text&#x2F;x-component</span><br><span class="line">    font&#x2F;opentype application&#x2F;x-font-ttf application&#x2F;vnd.ms-fontobject</span><br><span class="line">    image&#x2F;x-icon;</span><br><span class="line">gzip_disable  &quot;msie6&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="10-3-打开文件缓存"><a href="#10-3-打开文件缓存" class="headerlink" title="10.3 打开文件缓存"></a>10.3 打开文件缓存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache max&#x3D;1000 inactive&#x3D;20s;</span><br><span class="line">open_file_cache_valid 30s;</span><br><span class="line">open_file_cache_min_uses 2;</span><br><span class="line">open_file_cache_errors on;</span><br></pre></td></tr></table></figure>
<h3 id="10-4-SSL缓存"><a href="#10-4-SSL缓存" class="headerlink" title="10.4 SSL缓存"></a>10.4 SSL缓存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line">ssl_session_timeout 10m;</span><br></pre></td></tr></table></figure>
<h3 id="10-5-上游Keepalive"><a href="#10-5-上游Keepalive" class="headerlink" title="10.5 上游Keepalive"></a>10.5 上游Keepalive</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location &#x2F;api&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;backend;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Connection &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-6-监控"><a href="#10-6-监控" class="headerlink" title="10.6 监控"></a>10.6 监控</h3><blockquote>
<p>使用<code>ngxtop</code>实时解析<code>nginx</code>访问日志，并且将处理结果输出到终端，功能类似于系统命令<code>top</code>。所有示例都读取<code>nginx</code>配置文件的访问日志位置和格式。如果要指定访问日志文件和<code>/</code>或日志格式，请使用<code>-f</code>和<code>-a</code>选项。</p>
</blockquote>
<p><strong>注意</strong>：在<code>nginx</code>配置中<code>/usr/local/nginx/conf/nginx.conf</code>日志文件必须是绝对路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装 ngxtop</span><br><span class="line">pip install ngxtop</span><br><span class="line"></span><br><span class="line"># 实时状态</span><br><span class="line">ngxtop</span><br><span class="line"># 状态为404的前10个请求的路径：</span><br><span class="line">ngxtop top request_path --filter &#39;status &#x3D;&#x3D; 404&#39;</span><br><span class="line"></span><br><span class="line"># 发送总字节数最多的前10个请求</span><br><span class="line">ngxtop --order-by &#39;avg(bytes_sent) * count&#39;</span><br><span class="line"></span><br><span class="line"># 排名前十位的IP，例如，谁攻击你最多</span><br><span class="line">ngxtop --group-by remote_addr</span><br><span class="line"></span><br><span class="line"># 打印具有4xx或5xx状态的请求，以及status和http referer</span><br><span class="line">ngxtop -i &#39;status &gt;&#x3D; 400&#39; print request status http_referer</span><br><span class="line"></span><br><span class="line"># 由200个请求路径响应发送的平均正文字节以&#39;foo&#39;开始：</span><br><span class="line">ngxtop avg bytes_sent --filter &#39;status &#x3D;&#x3D; 200 and request_path.startswith(&quot;foo&quot;)&#39;</span><br><span class="line"></span><br><span class="line"># 使用“common”日志格式从远程机器分析apache访问日志</span><br><span class="line">ssh remote tail -f &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log | ngxtop -f common</span><br></pre></td></tr></table></figure>
<h2 id="十一、常见使用场景"><a href="#十一、常见使用场景" class="headerlink" title="十一、常见使用场景"></a>十一、常见使用场景</h2><h3 id="11-1-跨域问题"><a href="#11-1-跨域问题" class="headerlink" title="11.1 跨域问题"></a>11.1 跨域问题</h3><blockquote>
<p>在工作中，有时候会遇到一些接口不支持跨域，这时候可以简单的添加<code>add_headers</code>来支持<code>cors</code>跨域。配置如下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">    </span><br><span class="line">  add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;;</span><br><span class="line">  add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;</span><br><span class="line">  add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET,POST,HEAD&#39;;</span><br><span class="line"></span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:3000;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host  $http_host;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面更改头信息，还有一种，使用 rewrite 指令重定向URI来解决跨域问题。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">  server 127.0.0.1:8080;</span><br><span class="line">  server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    root  html;                   #去请求..&#x2F;html文件夹里的文件</span><br><span class="line">    index  index.html index.htm;  #首页响应地址</span><br><span class="line">  &#125;</span><br><span class="line">  # 用于拦截请求，匹配任何以 &#x2F;api&#x2F;开头的地址，</span><br><span class="line">  # 匹配符合以后，停止往下搜索正则。</span><br><span class="line">  location ^~&#x2F;api&#x2F;&#123;</span><br><span class="line">    # 代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用，</span><br><span class="line">    # 例如www.a.com&#x2F;proxy&#x2F;api&#x2F;msg?meth&#x3D;1&amp;par&#x3D;2重写，只对&#x2F;proxy&#x2F;api&#x2F;msg重写。</span><br><span class="line">    # rewrite后面的参数是一个简单的正则 ^&#x2F;api&#x2F;(.*)$，</span><br><span class="line">    # $1代表正则中的第一个()，$2代表第二个()的值，以此类推。</span><br><span class="line">    rewrite ^&#x2F;api&#x2F;(.*)$ &#x2F;$1 break;</span><br><span class="line">    </span><br><span class="line">    # 把请求代理到其他主机</span><br><span class="line">    # 其中 http:&#x2F;&#x2F;www.b.com&#x2F; 写法和 http:&#x2F;&#x2F;www.b.com写法的区别如下</span><br><span class="line">    # 如果你的请求地址是他 http:&#x2F;&#x2F;server&#x2F;html&#x2F;test.jsp</span><br><span class="line">    # 配置一：http:&#x2F;&#x2F;www.b.com&#x2F; 后面有“&#x2F;”</span><br><span class="line">    #         将反向代理成 http:&#x2F;&#x2F;www.b.com&#x2F;html&#x2F;test.jsp 访问</span><br><span class="line">    # 配置一：http:&#x2F;&#x2F;www.b.com 后面没有有“&#x2F;”</span><br><span class="line">    #         将反向代理成 http:&#x2F;&#x2F;www.b.com&#x2F;test.jsp 访问</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;test;</span><br><span class="line"></span><br><span class="line">    # 如果 proxy_pass  URL 是 http:&#x2F;&#x2F;a.xx.com&#x2F;platform&#x2F; 这种情况</span><br><span class="line">    # proxy_cookie_path应该设置成 &#x2F;platform&#x2F; &#x2F; (注意两个斜杠之间有空格)。</span><br><span class="line">    proxy_cookie_path &#x2F;platfrom&#x2F; &#x2F;;</span><br><span class="line"></span><br><span class="line">    # http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_proxy_module.html#proxy_pass_header</span><br><span class="line">    # 设置 Cookie 头通过</span><br><span class="line">    proxy_pass_header Set-Cookie;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-2-跳转到带www的域上面"><a href="#11-2-跳转到带www的域上面" class="headerlink" title="11.2 跳转到带www的域上面"></a>11.2 跳转到带www的域上面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    # 配置正常的带www的域名</span><br><span class="line">    server_name www.wangchujiang.com;</span><br><span class="line">    root &#x2F;home&#x2F;www&#x2F;wabg&#x2F;download;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        try_files $uri $uri&#x2F; &#x2F;index.html &#x3D;404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    # 这个要放到下面，</span><br><span class="line">    # 将不带www的 wangchujiang.com 永久性重定向到  https:&#x2F;&#x2F;www.wangchujiang.com</span><br><span class="line">    server_name wangchujiang.com;</span><br><span class="line">    rewrite ^(.*) https:&#x2F;&#x2F;www.wangchujiang.com$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-3-代理转发"><a href="#11-3-代理转发" class="headerlink" title="11.3 代理转发"></a>11.3 代理转发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">upstream server-api&#123;</span><br><span class="line">    # api 代理服务地址</span><br><span class="line">    server 127.0.0.1:3110;</span><br><span class="line">&#125;</span><br><span class="line">upstream server-resource&#123;</span><br><span class="line">    # 静态资源 代理服务地址</span><br><span class="line">    server 127.0.0.1:3120;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       3111;</span><br><span class="line">    server_name  localhost;      # 这里指定域名</span><br><span class="line">    root &#x2F;home&#x2F;www&#x2F;server-statics;</span><br><span class="line">    # 匹配 api 路由的反向代理到API服务</span><br><span class="line">    location ^~&#x2F;api&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;(.*)$ &#x2F;$1 break;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # 假设这里验证码也在API服务中</span><br><span class="line">    location ^~&#x2F;captcha &#123;</span><br><span class="line">        rewrite ^&#x2F;(.*)$ &#x2F;$1 break;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # 假设你的图片资源全部在另外一个服务上面</span><br><span class="line">    location ^~&#x2F;img&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;(.*)$ &#x2F;$1 break;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;server-resource;</span><br><span class="line">    &#125;</span><br><span class="line">    # 路由在前端，后端没有真实路由，在路由不存在的 404状态的页面返回 &#x2F;index.html</span><br><span class="line">    # 这个方式使用场景，你在写React或者Vue项目的时候，没有真实路由</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        try_files $uri $uri&#x2F; &#x2F;index.html &#x3D;404;</span><br><span class="line">        #                               ^ 空格很重要</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-4-代理转发连接替换"><a href="#11-4-代理转发连接替换" class="headerlink" title="11.4 代理转发连接替换"></a>11.4 代理转发连接替换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ^~&#x2F;api&#x2F;upload &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$ &#x2F;wfs&#x2F;v1&#x2F;upload break;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;wfs-api;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-5-ssl配置"><a href="#11-5-ssl配置" class="headerlink" title="11.5 ssl配置"></a>11.5 ssl配置</h3><blockquote>
<p>超文本传输安全协议（缩写：<code>HTTPS</code>，英语：Hypertext Transfer Protocol Secure）是超文本传输协议和SSL/TLS的组合，用以提供加密通讯及对网络服务器身份的鉴定。<code>HTTPS</code>连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输。<code>HTTPS</code>不应与在<code>RFC 2660</code>中定义的安全超文本传输协议（S-HTTP）相混。HTTPS 目前已经是所有注重隐私和安全的网站的首选，随着技术的不断发展，<code>HTTPS</code> 网站已不再是大型网站的专利，所有普通的个人站长和博客均可以自己动手搭建一个安全的加密的网站。</p>
</blockquote>
<p>创建<code>SSL</code>证书，如果你购买的证书，就可以直接下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir &#x2F;etc&#x2F;nginx&#x2F;ssl</span><br><span class="line"># 创建了有效期100年，加密强度为RSA2048的SSL密钥key和X509证书文件。</span><br><span class="line">sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;nginx.key -out &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;nginx.crt</span><br><span class="line"># 上面命令，会有下面需要填写内容</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.</span><br><span class="line">Organizational Unit Name (eg, section) []:Ministry of Water Slides</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:your_domain.com</span><br><span class="line">Email Address []:admin@your_domain.com</span><br></pre></td></tr></table></figure>
<p>创建自签证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">首先，创建证书和私钥的目录</span><br><span class="line"># mkdir -p &#x2F;etc&#x2F;nginx&#x2F;cert</span><br><span class="line"># cd &#x2F;etc&#x2F;nginx&#x2F;cert</span><br><span class="line">创建服务器私钥，命令会让你输入一个口令：</span><br><span class="line"># openssl genrsa -des3 -out nginx.key 2048</span><br><span class="line">创建签名请求的证书（CSR）：</span><br><span class="line"># openssl req -new -key nginx.key -out nginx.csr</span><br><span class="line">在加载SSL支持的Nginx并使用上述私钥时去必须的口令：</span><br><span class="line"># cp nginx.key nginx.key.org</span><br><span class="line"># openssl rsa -in nginx.key.org -out nginx.key</span><br><span class="line">最后标记证书使用上述私钥和CSR：</span><br><span class="line"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span><br></pre></td></tr></table></figure>
<p>查看目前<code>nginx</code>编译选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin&#x2F;nginx -V</span><br></pre></td></tr></table></figure>
<p>输出下面内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx&#x2F;1.7.8</span><br><span class="line">built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre</span><br></pre></td></tr></table></figure>
<p>如果依赖的模块不存在，可以进入安装目录，输入下面命令重新编译安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_stub_status_module --with-http_ssl_module</span><br></pre></td></tr></table></figure>
<p>运行完成之后还需要<code>make</code> (不用<code>make install</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 备份nginx的二进制文件</span><br><span class="line">cp -rf &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx  &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx.bak</span><br><span class="line"># 覆盖nginx的二进制文件</span><br><span class="line">cp -rf objs&#x2F;nginx   &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;</span><br></pre></td></tr></table></figure>
<p><strong>HTTPS server</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;nginx.crt;</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;nginx.key;</span><br><span class="line">    # 禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span><br><span class="line">    server_tokens off;</span><br><span class="line">    # 设置ssl&#x2F;tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，和off差不多，停用缓存。如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存，官网介绍说1M可以存放约4000个sessions。</span><br><span class="line">    ssl_session_cache    shared:SSL:1m;</span><br><span class="line"></span><br><span class="line">    # 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    # 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span><br><span class="line">    # 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#39;RC4:HIGH:!aNULL:!MD5&#39;（后面是你所指定的套件加密算法） 来看所支持算法。</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    # 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-6-强制将http重定向到https"><a href="#11-6-强制将http重定向到https" class="headerlink" title="11.6 强制将http重定向到https"></a>11.6 强制将http重定向到https</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  example.com;</span><br><span class="line">    rewrite ^ https:&#x2F;&#x2F;$http_host$request_uri? permanent;    # 强制将http重定向到https</span><br><span class="line">    # 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本。防止黑客利用版本漏洞攻击</span><br><span class="line">    server_tokens off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-7-两个虚拟主机"><a href="#11-7-两个虚拟主机" class="headerlink" title="11.7 两个虚拟主机"></a>11.7 两个虚拟主机</h3><blockquote>
<p>纯静态<code>-html</code>支持</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain1.com;</span><br><span class="line">        access_log      logs&#x2F;domain1.access.log main;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  &#x2F;var&#x2F;www&#x2F;domain1.com&#x2F;htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain2.com;</span><br><span class="line">        access_log      logs&#x2F;domain2.access.log main;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  &#x2F;var&#x2F;www&#x2F;domain2.com&#x2F;htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-8-虚拟主机标准配置"><a href="#11-8-虚拟主机标准配置" class="headerlink" title="11.8 虚拟主机标准配置"></a>11.8 虚拟主机标准配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen          80 default;</span><br><span class="line">    server_name     _ *;</span><br><span class="line">    access_log      logs&#x2F;default.access.log main;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">       index index.html;</span><br><span class="line">       root  &#x2F;var&#x2F;www&#x2F;default&#x2F;htdocs;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-9-防盗链"><a href="#11-9-防盗链" class="headerlink" title="11.9 防盗链"></a>11.9 防盗链</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">   root html</span><br><span class="line">   valid_referers none blocked *.nginxcn.com;</span><br><span class="line">   if ($invalid_referer) &#123;</span><br><span class="line">     rewrite ^&#x2F; www.nginx.cn</span><br><span class="line">     #return 404;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-10虚拟目录配置"><a href="#11-10虚拟目录配置" class="headerlink" title="11.10虚拟目录配置"></a>11.10虚拟目录配置</h3><blockquote>
<p><code>alias</code>指定的目录是准确的，<code>root</code>是指定目录的上级目录，并且该上级目录要含有<code>location</code>指定名称的同名目录。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;img&#x2F; &#123;</span><br><span class="line">    alias &#x2F;var&#x2F;www&#x2F;image&#x2F;;</span><br><span class="line">&#125;</span><br><span class="line"># 访问&#x2F;img&#x2F;目录里面的文件时，ningx会自动去&#x2F;var&#x2F;www&#x2F;image&#x2F;目录找文件</span><br><span class="line">location &#x2F;img&#x2F; &#123;</span><br><span class="line">    root &#x2F;var&#x2F;www&#x2F;image;</span><br><span class="line">&#125;</span><br><span class="line"># 访问&#x2F;img&#x2F;目录下的文件时，nginx会去&#x2F;var&#x2F;www&#x2F;image&#x2F;img&#x2F;目录下找文件。]</span><br></pre></td></tr></table></figure>
<h3 id="11-11-防盗图配置"><a href="#11-11-防盗图配置" class="headerlink" title="11.11 防盗图配置"></a>11.11 防盗图配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \&#x2F;public\&#x2F;(css|js|img)\&#x2F;.*\.(js|css|gif|jpg|jpeg|png|bmp|swf) &#123;</span><br><span class="line">    valid_referers none blocked *.jslite.io;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        rewrite ^&#x2F;  http:&#x2F;&#x2F;wangchujiang.com&#x2F;piratesp.png;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-12-屏蔽-git等文件"><a href="#11-12-屏蔽-git等文件" class="headerlink" title="11.12 屏蔽.git等文件"></a>11.12 屏蔽.git等文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ (.git|.gitattributes|.gitignore|.svn) &#123;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-13-域名路径加不加需要都能正常访问"><a href="#11-13-域名路径加不加需要都能正常访问" class="headerlink" title="11.13 域名路径加不加需要都能正常访问"></a>11.13 域名路径加不加需要都能正常访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;wangchujiang.com&#x2F;api&#x2F;index.php?a&#x3D;1&amp;name&#x3D;wcj</span><br><span class="line">                                  ^ 有后缀</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;wangchujiang.com&#x2F;api&#x2F;index?a&#x3D;1&amp;name&#x3D;wcj</span><br><span class="line">                                 ^ 没有后缀</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>nginx rewrite</code>规则如下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^&#x2F;(.*)&#x2F;$ &#x2F;index.php?&#x2F;$1 permanent;</span><br><span class="line">if (!-d $request_filename)&#123;</span><br><span class="line">        set $rule_1 1$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">        set $rule_1 2$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if ($rule_1 &#x3D; &quot;21&quot;)&#123;</span><br><span class="line">        rewrite ^&#x2F; &#x2F;index.php last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十二、错误问题"><a href="#十二、错误问题" class="headerlink" title="十二、错误问题"></a>十二、错误问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The plain HTTP request was sent to HTTPS port</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解决办法，<code>fastcgi_param HTTPS $https if_not_empty</code> 添加这条规则，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl; # 注意这条规则</span><br><span class="line">    server_name  my.domain.com;</span><br><span class="line">    </span><br><span class="line">    fastcgi_param HTTPS $https if_not_empty;</span><br><span class="line">    fastcgi_param HTTPS on;</span><br><span class="line"></span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;your.pem;</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;your.key;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        # Your config here...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/11/essay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/11/essay/" class="post-title-link" itemprop="url">如何只使用CSS提升页面渲染速度</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-11 20:35:43 / 修改时间：20:38:28" itemprop="dateCreated datePublished" datetime="2021-01-11T20:35:43+08:00">2021-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="如何只使用CSS提升页面渲染速度"><a href="#如何只使用CSS提升页面渲染速度" class="headerlink" title="如何只使用CSS提升页面渲染速度"></a>如何只使用CSS提升页面渲染速度</h2><h2 id="1-Content-visibility"><a href="#1-Content-visibility" class="headerlink" title="1. Content-visibility"></a>1. Content-visibility</h2><p>一般来说，大部分 Web 应用都有复杂的 UI 元素，并且它的扩展超出了用户在浏览器视图中所能看到的范围。在这种情况下，我们可以使用<code>content-visibility</code>来跳过渲染屏幕之外的内容。如果你有大量屏幕之外的内容的话，这会大大减少页面渲染时间。</p>
<p>这个功能是最新添加的功能之一，而且它是提升渲染性能最有影响力的功能之一。<code>content-visibility</code>接受几个值，我们可以在一个元素上使用<code>content-visibility: auto;</code>来立即获得性能提升。</p>
<p>我们可以看下面这个页面，包含很多显示不同信息的卡片。虽然屏幕能显示大约 12 个卡片，但列表中有差不多 375 个卡片。如你所见，浏览器花费 1037ms 来渲染这个页面。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQloBBJxWYiaqrlQRu5aSuHagd15Ujxh6bKvTSQ00RH0GMdUkg2kVFDlA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                            一般 HTML 页面</p>
<p>下一步，你可以向所有的卡片中加入<code>content-visibility</code>。</p>
<blockquote>
<p>在这个例子中，向页面中加入<code>content-visibility</code>后，渲染时间下降到 150ms。性能提升了 6 倍以上。</p>
</blockquote>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQGB6nhGXISyGR2n6NV5VIJicYapxeLcBFFZxwau61jxsLdcwzeUDLzxA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                        使用 content-visibility</p>
<p>如你所见，content-visibility 的功能很强大，对于改善页面渲染时间非常有用。根据我们目前为止讨论的内容，你一定在想它是针对页面渲染的灵丹妙药。</p>
<p>content-visibility 的限制</p>
<p>然而，也有一些领域 content-visibility 不适合。我想强调 2 点供你考虑。</p>
<p><strong>这个功能还是实验性的。</strong>目前，Firefox（PC 和 Android 版本）、Internet Explorer (我不认为他们计划向 IE 中添加这个功能) 以及 Safari (Mac 和 iOS) 不支持 content-visibility。</p>
<p><strong>与滚动条行为相关的问题。</strong>由于元素最初渲染的高度是 0px，当你向下滚动时，这些元素会进入屏幕。实际的内容会被渲染，这个元素的高度会被相应地更新。这会使滚动条出现预料之外的行为。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQaLaSDNgS2kHGQhEBwoyibPxiaKR3zovQsA2W9xNRkT1bDPmmPQ1VPIjQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                使用 content-visibility 的滚动行为</p>
<p>为了修复这个滚动条问题，你可以使用另一个 CSS 属性，<code>contain-intrinsic-size</code>。它指定了一个元素的自然大小。因此，这个元素会用指定的高度渲染，而不是 0px。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.element</span>&#123;</span><br><span class="line">    <span class="attribute">content-visibility</span>: auto;</span><br><span class="line">    <span class="attribute">contain-intrinsic-size</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，在实验时，我发现即使使用<code>containt-intrinsic-size</code>，如果我们有很多元素都使用<code>content-visibility</code>且设置为<code>auto</code>，你仍然会有微小的滚动条问题。因此，我的建议是规划你的布局，将它分解为几个部分，然后在那几个部分上使用 content-visibility 来获取更好的滚动条行为。</p>
<h2 id="2-Will-change属性"><a href="#2-Will-change属性" class="headerlink" title="2.Will-change属性"></a>2.Will-change属性</h2><p>浏览器上的动画并不是一个新鲜事物。通常，这些动画与其它元素一起正常渲染。然而，浏览器现在能够使用 GPU 来优化这些动画的某些操作。</p>
<blockquote>
<p>使用 will-change CSS 属性，我们可以表明该元素将要修改特定的属性，让浏览器提前执行必要的优化。</p>
</blockquote>
<p>底层发生的是，浏览器会为这个元素创建一个单独的层。然后，浏览器将这个元素的渲染委托给 GPU，以及其它一些优化。由于 GPU 加速接管了动画渲染，最终这个动画会更流畅。</p>
<p>考虑如下 CSS 类：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// In stylesheet</span><br><span class="line">.animating-element &#123;</span><br><span class="line">  will-change: opacity;</span><br><span class="line">&#125;</span><br><span class="line">// In HTML</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;animating-elememt&quot;</span>&gt;</span></span><br><span class="line">  Animating Child elements</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当在浏览器中渲染上面的代码时，它会识别出<code>will-change</code>属性，并优化未来与不透明度 opacity 相关的变更。</p>
<blockquote>
<p>根据 Maximillian Laumeister 所做的性能基准测试，你可以看到他只改变了一行代码就获得了超过 120FPS 的渲染速度，而最初的渲染速度大约是 50FPS。</p>
</blockquote>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQgA1via3WP4UvGBqRrDSpvJFMBic3S7DjWH6PN10ocpPFFESK6q4PM80g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                            不使用 will-change</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQVVRnOYMFHwWCEECc8y23r1pPwD9JEia5y4HM7GM7uUnickYic1W9KmX0w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                            使用 will-change</p>
<p>什么时候不要用 will-change</p>
<p>尽管<code>will-change</code>是用来提升性能的，但如果你误用它，也会降低 Web 应用的性能。</p>
<p><strong>使用</strong><code>will-change</code><strong>表明这个元素将来会改变</strong>。</p>
<p>因此，如果你试图将<code>will-change</code>与同步动画一起使用，它不会给你优化。因此，建议在父元素上使用 will-change，在子元素上使用动画。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-class</span>&#123;</span><br><span class="line">  <span class="attribute">will-change</span>: opacity;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child-class</span>&#123;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">1s</span> ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>不要使用未设置动画的元素。</strong>当你在一个元素上使用<code>will-change</code>，浏览器会尝试通过将它放到一个新层中并将转换移交给 GPU 来优化它。如果你没有要转换的东西，这会导致资源浪费。</p>
<p>最后要记住的是，建议在完成所有动画之后将 will-change 从元素上删除。</p>
<h2 id="3-减少渲染阻塞时间"><a href="#3-减少渲染阻塞时间" class="headerlink" title="3.减少渲染阻塞时间"></a>3.减少渲染阻塞时间</h2><p>今天，许多 Web 应用必须满足许多形式因素，包括 PC、平板电脑和移动手机等。为了实现这种响应式特性，我们必须根据媒介大小编写新的样式。在页面渲染时，直到 CSS 对象模型（CSS Object Model，CSSOM）准备就绪，它才开始渲染阶段。根据你的 Web 应用，你可能有一个很大的样式表来满足所有的设备形式因素。</p>
<p>然而，假设我们根据形式因素将它拆分成多个样式表。在这种情况下，我们可以只让主 CSS 文件阻塞关键路径，并将其优先下载，让其它样式表以低优先级的方式下载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;styles.css&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQKiaGXxF2gIakErRUPVu7D3H8bJ9jIkXplLRHSBUV1o1OZgmxia8NB0mg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                        单个样式表</p>
<p>在将它分解成多个样式表后：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- style.css contains only the minimal styles needed for the page rendering --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;all&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Following stylesheets have only the styles necessary for the form factor --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;sm.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 20em)&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;md.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 64em)&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;lg.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 90em)&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;ex.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 120em)&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;print.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;print&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQ65KrxnHCMsDU7XicXibcibZk3cePV4RXSP7buCQVeT6MzoS6BiadQTuuCw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>如你所见，根据形式因素拆分样式表能够减少渲染阻塞时间。</p>
<h2 id="4-避免使用-import-来包含多个样式表"><a href="#4-避免使用-import-来包含多个样式表" class="headerlink" title="4. 避免使用 @import 来包含多个样式表"></a>4. 避免使用 @import 来包含多个样式表</h2><p>使用<code>@import</code>，我们可以在一个样式表中包含另一个样式表。当我们在处理一个大型项目时，使用<code>@import</code>会让代码更简洁。</p>
<p>关于 @import 的一个关键事实是，它是一个阻塞调用，因为它必须发起一个网络请求来获取这个文件，解析它，然后将它包含在样式表中。如果我们在样式表中有嵌套的 @import，它会妨碍渲染性能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># style.css</span><br><span class="line">@<span class="keyword">import</span> url(<span class="string">&quot;windows.css&quot;</span>);</span><br><span class="line"># windows.css</span><br><span class="line">@<span class="keyword">import</span> url(<span class="string">&quot;componenets.css&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQo17CuJctpLtPLkMkFicqWSrUVqTDkXibu6a7lM3krUEYqLx5sEFkonYA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                            使用 imports 的瀑布图</p>
<p>与其使用<code>@import</code>，我们可以使用多个链接 link 实现相同的功能且具有更好的性能，因为它允许并行下载样式表。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkVfKficWWWfwGWY6EVzEWibhQufUV1fia7Xd21FL6VEtLVbBn9B8uf6CwLSg5gl2lngRpJ9kHSEfFrkA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                使用链接的瀑布图</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/08/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="西决">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西决的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/08/hello-world/" class="post-title-link" itemprop="url">博客搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-08 13:52:54 / 修改时间：17:17:38" itemprop="dateCreated datePublished" datetime="2021-01-08T13:52:54+08:00">2021-01-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="西决"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">西决</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">西决</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
